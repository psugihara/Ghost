<!DOCTYPE html>
<html lang="en">
<head>
<title>GOST</title>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
<script type="text/javascript" src="https://raw.github.com/DmitryBaranovskiy/raphael/master/raphael-min.js"></script>
<script src="/nowjs/now.js"></script>

<style type="text/css" media="screen">
	body {
		background: #f5f5f5;
		cursor: crosshair;
		
	}
	#messages{
	  width:200px;
	  float:left;
	}
	#container {
	  border:1px solid black;
		width: 900px;
		float:right;
		margin-right:50px;
	}
	#list{
	  float:left;
	  width:200px;
	  height:auto;
	}
	canvas#board {
		background: #fff;
		cursor: crosshair;
		border: 1px solid #ccc;
		border-radius: 10px;
		box-shadow: inset 0 0 5px #aaa;
		
		width: 900px;
		height: 600px;
	}
</style>

<script>
$(document).ready(function(){
  now.receiveMessage = function(name, message){
    $("#messages").append("<br>" + name + ": " + message);
  }
  
  $("#send-button").click(function(){
    now.distributeMessage($("#text-input").val());
    $("#text-input").val("");
  });
  
  now.updateList = function(){
    setTimeout(function(){
      var list = "LIST:<br>";
      console.log(now.clients);
      console.log(now.name);
      for (var i in now.clients) {
        list += now.clients[i]+"<br>";
      }
      /*
      $.each(now.clients, function(index, value){
        list += value+"<br>";
      });
      */
      $("#list").html(list);
    }, 1500);
  }


});

now.ready(function(){
  var image = [];
  var lastPoint = "";
  var draw = false;
  now.setName(prompt("name?"));
  
  var paper = Raphael(200,50,800,600);
  var r = paper.rect(0,0,800,600).attr("fill","white").attr("stroke", "blue");
  var path = paper.path();
  


  $(window).mousedown(function(){

      draw = true;
    console.log(draw);
  });
  $(window).mouseup(function(){

      draw = false;
      lastPoint = "";
  });

  $(r.node).mousemove(function(e){
    if(draw){
      image.push({x:e.offsetX, y:e.offsetY});
      //console.log(image);
    }
    
  })
  
  function drawing(){
      if (image.length === 0) {
        return;
      }
      var p = image.shift();
      if(lastPoint == ""){
        lastPoint = p;
        path = paper.path("M"+(p.x-1)+" "+(p.y-1)+"L"+(p.x)+" "+(p.y));
      }
      else{
        path = paper.path("M"+(lastPoint.x)+" "+(lastPoint.y)+"L"+(p.x)+" "+(p.y));
        lastPoint = p;
      }
  }
  var go = setInterval(drawing, 10);
  
  
});

$(window).load(function() {
  /*8
  var ctx, draw, draw_point, draw_queue, eval_draw_queue, first_point, setup_canvas;
  ctx = null;
  first_point = true;
  draw = false;
  draw_queue = [];
  setup_canvas = function() {
    var canvas;
    draw = false;
    canvas = $('canvas#board')[0];
    ctx = canvas.getContext('2d');
    ctx.translate(0.5, 0.5);
    ctx.strokeStyle = 'black';
    ctx.lineWidth = 5;
    ctx.lineCap = 'round';
    $('canvas#board').mousedown(function() {
      return draw = true;
    });
    $('canvas#board').mouseup(function() {
      draw = false;
      return first_point = true;
    });
    return $('canvas#board').mousemove(function(e) {
      if (draw) {
        return draw_queue.push([e.offsetX, e.offsetY]);
      }
    });
  };
  draw_point = function(x, y) {
    if (first_point) {
      ctx.moveTo(x - 1, y - 1);
      first_point = false;
    }
    ctx.lineTo(x, y);
    return ctx.stroke();
  };
  eval_draw_queue = function() {
    var next;
    if (draw_queue.length === 0) {
      return;
    }
    next = draw_queue.shift();
    return now.distribute_draw(next[0], next[1]);
  };
  now.receive_draw = function(x, y) {
    return draw_point(x, y);
  };
  
  setup_canvas();
  setInterval(eval_draw_queue, 10);
  */
  //console.log(now);
  //return now.distribute_name(prompt("butt?", ""));
});

</script>
</head>

<body>
<div id="messages"></div><input type="text" id="text-input"><input type="button" value="Send" id="send-button"><br>
<div id="list"></div>
<!--
<div id="container">
	<canvas id="board" width="900" height="600"></canvas>
	<ul id="players">
	
	</ul>
</div>-->
</body>
</html>